#!/usr/bin/python2

import os
import sys
import util
import importrpm
import string
import versioned

DBPATH=os.getcwd() + "/srsdb"

scratch = DBPATH + "/scratch"
fileDB = DBPATH + "/files"
pkgDB = DBPATH + "/pkgs"
util.mkdirChain(scratch, fileDB, pkgDB)

def usage():
    print "usage: srs import <file.rpm>"
    print "           pkglist <pkg>"
    sys.exit(0)

def displayPkgs(DBPATH, packageList):
    for pkgName in packageList:
	f = versioned.open(DBPATH + "/pkgs/" + pkgName, "r")
	l = f.versionList()
	l.sort()
	for version in l:
	    print "%-24s %s" % (pkgName, version)
	f.close()

if (len(sys.argv) < 2):
    usage()
elif (sys.argv[1] == "import"):
    for file in sys.argv[2:]:
	importrpm.doImport(DBPATH, file)
elif (sys.argv[1] == "pkglist"):
    if (len(sys.argv) == 2):
	displayPkgs(DBPATH, os.listdir(DBPATH + "/pkgs"))
    else:
	displayPkgs(DBPATH, sys.argv[2:])
else:
    usage()
