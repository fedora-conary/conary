#
# Copyright (c) 2004 Specifix, Inc.
# All rights reserved
#

class tmpwatch(Recipe):
    buildRequires = [ "glibc" ]

    name = "tmpwatch"
    version = "2.9.0"

    def setup(r):
	r.macros.rpmrevision = "2.1"
	# The canonical URL is "ftp://ftp.redhat.com/pub/fedora/linux/core/development/SRPMS/tmpwatch-%(version)s-%(rpmrevision)s.src.rpm"
	# but it is always too busy, so we'll go to a well-known mirror instead
	r.addArchive("tmpwatch-%(version)s.tar.gz",
	    rpm="http://www.gtlib.cc.gatech.edu/pub/fedora.redhat/linux/core/development/SRPMS/tmpwatch-%(version)s-%(rpmrevision)s.src.rpm")
	r.addSource("crond-tmpwatch")
	# r.macros.bugid must be set
	r.addSource("tmpwatch.fakebug.patch")

	r.Run('sed -i "s/@BUGID@/%(bugid)s/" tmpwatch.fakebug.patch')
	r.Run('cat tmpwatch.fakebug.patch')
	r.Run('patch -p1 < tmpwatch.fakebug.patch')
	r.Make()
	r.MakeInstall(rootVar = "ROOT")
	r.InstallFiles("crond-tmpwatch", "/etc/cron.daily/tmpwatch", mode=0755)
